<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Resource Tester with Debug Info</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .controls {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
      }
      button:hover {
        background-color: #45a049;
      }
      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      #startBtn {
        background-color: #4caf50;
      }
      #resetBtn {
        background-color: #f44336;
      }
      #calculateBtn {
        background-color: #2196f3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
        position: sticky;
        top: 0;
      }
      tr:nth-child(even) {
        background-color: #f9f9f9;
      }
      tr.testing {
        background-color: #fff9c4;
      }
      tr.completed {
        background-color: #e8f5e9;
      }
      tr.error {
        background-color: #ffebee;
      }
      .summary-card {
        background-color: #e3f2fd;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .summary-card h2 {
        margin-top: 0;
        color: #1565c0;
      }
      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }
      .summary-item {
        background-color: white;
        padding: 15px;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .summary-item h3 {
        margin-top: 0;
        color: #333;
        font-size: 16px;
      }
      .summary-item p {
        margin-bottom: 0;
        font-size: 24px;
        font-weight: bold;
        color: #1565c0;
      }
      #videoContainer {
        display: none;
      }
      .progress-container {
        margin-top: 10px;
        background-color: #f5f5f5;
        border-radius: 4px;
        height: 20px;
        position: relative;
      }
      .progress-bar {
        height: 100%;
        background-color: #4caf50;
        border-radius: 4px;
        width: 0%;
        transition: width 0.3s;
      }
      .progress-text {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        text-align: center;
        line-height: 20px;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
      }
      .resources-list {
        margin-bottom: 20px;
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
      }
      .resources-list h2 {
        margin-top: 0;
        color: #333;
      }
      .resources-list ul {
        margin: 0;
        padding-left: 20px;
      }
      .resources-list li {
        margin-bottom: 5px;
      }
      .debug-info {
        background-color: #f0f8ff;
        border: 1px solid #b0c4de;
        border-radius: 4px;
        padding: 10px;
        margin-top: 10px;
        font-family: monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
      }
      .debug-info h4 {
        margin-top: 0;
        margin-bottom: 5px;
        color: #333;
      }
      .debug-info pre {
        margin: 0;
        white-space: pre-wrap;
      }
      .debug-toggle {
        cursor: pointer;
        color: #1565c0;
        text-decoration: underline;
        font-size: 14px;
        margin-top: 5px;
        display: inline-block;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Video Resource Tester with Debug Info</h1>

    <div class="resources-list">
      <h2>Hardcoded Resources</h2>
      <ul id="resourcesList"></ul>
    </div>

    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="resetBtn" disabled>Reset</button>
      <button id="calculateBtn" disabled>Calculate</button>
    </div>

    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
      <div class="progress-text" id="progressText">0%</div>
    </div>

    <table id="resultsTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Resource URL</th>
          <th>Waiting Time (ms)</th>
          <th>Download Speed</th>
          <th>Status</th>
          <th>Debug Info</th>
        </tr>
      </thead>
      <tbody id="resultsBody"></tbody>
    </table>

    <div class="summary-card" id="summaryCard" style="display: none">
      <h2>Test Results Summary</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <h3>Average Waiting Time</h3>
          <p id="avgWaitingTime">-</p>
        </div>
        <div class="summary-item">
          <h3>Average Download Speed</h3>
          <p id="avgDownloadSpeed">-</p>
        </div>
        <div class="summary-item">
          <h3>Total Resources</h3>
          <p id="totalResources">-</p>
        </div>
        <div class="summary-item">
          <h3>Successful Tests</h3>
          <p id="successfulTests">-</p>
        </div>
      </div>
    </div>

    <div id="videoContainer"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // DOM Elements
        const startBtn = document.getElementById("startBtn");
        const resetBtn = document.getElementById("resetBtn");
        const calculateBtn = document.getElementById("calculateBtn");
        const resultsBody = document.getElementById("resultsBody");
        const videoContainer = document.getElementById("videoContainer");
        const summaryCard = document.getElementById("summaryCard");
        const avgWaitingTimeEl = document.getElementById("avgWaitingTime");
        const avgDownloadSpeedEl = document.getElementById("avgDownloadSpeed");
        const totalResourcesEl = document.getElementById("totalResources");
        const successfulTestsEl = document.getElementById("successfulTests");
        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");
        const resourcesList = document.getElementById("resourcesList");

        // Hardcoded resources list
        const resources = [
    "https://v16m.tiktokcdn-us.com/65ebe800f9001b9b1390697503f82110/6847956c/video/tos/useast8/tos-useast8-ve-0068c002-tx2/oEAIWYNEzGiDHCqCAeq9hfEkFIAjLQ5uueSKGI/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1758&bt=879&cs=0&ds=6&ft=GSDrKInz7Th-KrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=OmZlZTlpNTo8NTc0PDM8NUBpM2tuanE5cjpqdTMzaTczNEBiMF4vY2MwNjExM2E1NWE1YSNjZm4vMmRram1gLS1kMTJzcw%3D%3D&vvpl=1&l=2025060920151369E1667231F4951BF917&btag=e00088000",
    "https://v19.tiktokcdn-us.com/66cf2f7e9f0137e49bf484f25f43b4e7/68479535/video/tos/useast5/tos-useast5-pve-0068-tx/oMIpKRBm3REL6FBke5lD3gQES9DfAjpMCEDbEC/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=3722&bt=1861&cs=0&ds=6&ft=GSDrKInz7ThSKrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=OGQ8Z2Y4ZjtoZTc2Z2dmZkBpanc7cHg5cjs1czMzZzczNEA2Y2FfYTYyNjExLTIyYmI2YSNwMGxoMmRzcS9gLS1kMS9zcw%3D%3D&vvpl=1&l=20250609201502A6A8BFEB66667D19E7A9&btag=e000b0000",
    "https://v19.tiktokcdn-us.com/3733e18ce7faf6453ef778513792f86b/68478863/video/tos/useast5/tos-useast5-pve-0068-tx/osAfzADTwkgSAEINOsFfHCAUxDuFeyQrjKDjI5/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1888&bt=944&cs=0&ds=6&ft=GSDrKInz7ThMr~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=Ozk7PDhkNGg4MzU5Ozc2OEBpanIzcms5cmhydTMzZzczNEAtNmE1MGBfXl4xMGIwYzA1YSNwMC1uMmRjY2BgLS1kMS9zcw%3D%3D&vvpl=1&l=20250609191952FDD7DB9702A09A16E37D&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/6721fc2949c4debee2a2fab37978c92d/68478b68/video/tos/useast5/tos-useast5-pve-0068-tx/oIIwyXjIQHAecIepgNjAPeS8kCLsU7UG9RmbA0/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=3098&bt=1549&cs=0&ds=6&ft=GSDrKInz7ThN1~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=OTlpZ2U8ZDRpMzhkNmQ2NEBpajhsO3c5cjZ4dDMzZzczNEAwYjRfMzMyX14xLy8wX18tYSM0cnMvMmRjb2hgLS1kMS9zcw%3D%3D&vvpl=1&l=202506091932256E4464348C8E5D051776&btag=e00090000",
    "https://v16m.tiktokcdn-us.com/9ed241c5d980cd3a4dade8680550dee0/6847950b/video/tos/useast8/tos-useast8-ve-0068c004-tx2/ocIiH6E9Ei3WRRVxAxQXwAF3XlBoHC0Z1vBPC/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=3060&bt=1530&cs=0&ds=6&ft=GSDrKInz7ThqWrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=PGQ0O2llO2c1Nzs3ODc5ZEBpajU2NHc5cnB2dTMzaTczNEAyXjI2NTUuXjYxMjMxMzUvYSM1YnJxMmQ0Ym5gLS1kMTJzcw%3D%3D&vvpl=1&l=2025060920141944A62CEE09BB3A071CAB&btag=e000b8000",
    "https://v19.tiktokcdn-us.com/c01ff5f56e36018cbcfe872da58aa3ce/68478b4d/video/tos/useast8/tos-useast8-ve-0068c001-tx2/oA6MCCmiIqsfaw7DGAQwcENcIAKzZzBcn4WiiA/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1136&bt=568&cs=0&ds=6&ft=GSDrKInz7ThH1~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=NjZmaWVkNGc2ODVkM2c2PEBpamY4ZW05cnY0dTMzaTczNEBgLjEzNTEuNjAxLi9hNl8wYSMuaDAyMmRjZGdgLS1kMTJzcw%3D%3D&vvpl=1&l=20250609193229B9A488AF38E21F05B4BA&btag=e00088000",
    "https://v19.tiktokcdn-us.com/2c9f92eb28922b972d80f8a227d50d4f/684789fc/video/tos/useast8/tos-useast8-pve-0068-tx2/oEHliDyrEAVlzpQE2EWE6IbCHIHRA3FemKB38f/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2016&bt=1008&cs=0&ds=6&ft=GSDrKInz7ThQS~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=ZjU1Zjc0Z2VoNTs6ODQ2ZUBpMzxyeHU5cnM4dTMzaTczNEBhYC9iLy5eXzMxNTFiX15jYSNyZXNgMmRjYTJgLS1kMTJzcw%3D%3D&vvpl=1&l=2025060919270007BCA320A9D8DC1A706D&btag=e000b8000",
    "https://v19.tiktokcdn-us.com/2b495a4a99dac759d5b2267f78fbfd6a/68479413/video/tos/useast8/tos-useast8-ve-0068c004-tx2/okSUqg1RG0UonCeFAIeeATAkkLKCJOIIOKAjjk/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1430&bt=715&cs=0&ds=6&ft=GSDrKInz7ThMs~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=Njs0OjdoNDU0aTtpaTk1NEBpMzRuO2w5cjltdjMzaTczNEAvNS9gXjUvNi0xNl4wMGI1YSM1ZjJlMmRrbmhgLS1kMTJzcw%3D%3D&vvpl=1&l=202506092010009AAD5D45BC7E7A195A13&btag=e000b8000",
    "https://v16m.tiktokcdn-us.com/526ed74377b8093b00092a9801f53e2b/68478e2e/video/tos/useast5/tos-useast5-pve-0068-tx/oQBnEz4ARUUiCViIzMEQp4ApcCwfoFyvo5NI0B/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1508&bt=754&cs=0&ds=6&ft=GSDrKInz7ThqG~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=OTVmZTs2aWRmZztlOjw3aEBpM2Zrc2w5cjVqczMzZzczNEA2MmAxLjBiX14xLi01MzRhYSNoNW81MmRzaGtgLS1kMS9zcw%3D%3D&vvpl=1&l=202506091944289A4F2B518A075A1D8EFF&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/394387f16476f17febda774393f5c3e9/68478c00/video/tos/useast8/tos-useast8-ve-0068c002-tx2/o4ebngUGbFfLsCzLIXrfwAQTRQTTepmAoGIAPR/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2782&bt=1391&cs=0&ds=6&ft=GSDrKInz7ThDT~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=OmU4NjRoPGY5aWY8Z2U8ZkBpanVtaGw5cnR5dTMzaTczNEAxY2FhYy5gNjMxYjEzMWIyYSM0bWRuMmQ0amhgLS1kMTJzcw%3D%3D&vvpl=1&l=20250609193450DAC570D4BACD4919B806&btag=e00090000",
    "https://v16m.tiktokcdn-us.com/525f998de6d1c72873d3271215ad0f62/68478e3a/video/tos/useast8/tos-useast8-pve-0068-tx2/owmrVXYvSBKQBAFRnE6IRfMgDjELApfkzrODEY/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1366&bt=683&cs=0&ds=6&ft=GSDrKInz7Thj.~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=NDZlOGlnPGRnOTg7M2c4aUBpMzhxdG05cm40dDMzaTczNEAzMF81YGMyXzMxMF8wX2I2YSMzbjFvMmRraTNgLS1kMTJzcw%3D%3D&vvpl=1&l=202506091945083AAAB8E0D57BC9183D56&btag=e000b8000",
    "https://v16m.tiktokcdn-us.com/3f6d503d476381ede789bd99176aeff0/68479433/video/tos/useast5/tos-useast5-ve-0068c004-tx/o8zbpGppaA8IIAiI6BAENbsQOVClwHfOA6IBiZ/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2172&bt=1086&cs=0&ds=6&ft=GSDrKInz7Thda~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=Ozs5PGU7OTM4Ojg0N2Q3O0BpanZubXQ5cmdrdDMzZzczNEAyNmIyMTQ1XjYxNS5hNWBeYSNgLmBoMmRjbmhgLS1kMS9zcw%3D%3D&vvpl=1&l=2025060920090919D9EDED6E6BD407039D&btag=e00090000",
    "https://v16m.tiktokcdn-us.com/c5576836bfdbf14dd85f80b521403d41/68479410/video/tos/useast8/tos-useast8-pve-0068-tx2/o0EX0yIAV6AF5ECLOlRurufzczDtEBKEuQSme4/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2338&bt=1169&cs=0&ds=6&ft=GSDrKInz7Thda~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=NjwzNGRkNTppaTppZDYzPEBpamh4Zm85cnY1dDMzaTczNEBhLmA0LjMxXjMxLTUtX2AuYSNwcW5zMmRrbXBgLS1kMTJzcw%3D%3D&vvpl=1&l=2025060920090919D9EDED6E6BD407039D&btag=e00090000",
    "https://v19.tiktokcdn-us.com/cc429738bfd9ac6df47113fa58c0bc36/68479597/video/tos/useast5/tos-useast5-ve-0068c002-tx/okCNAyLPLL4JcIZgQOIGSoeyI5UwAGjPHkeBfj/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=3128&bt=1564&cs=0&ds=6&ft=GSDrKInz7ThVVrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=aDM6aDs5NDYzNWRpaTxlOUBpajg2am45cmpmdjMzZzczNEAvNC8wMTBjXjIxYDQzXmAyYSNwc3NnMmQ0ZWNgLS1kMS9zcw%3D%3D&vvpl=1&l=2025060920162924E438DB72DE5707876A&btag=e000b8000",
    "https://v19.tiktokcdn-us.com/3c3cf0d4dbe4dc7d2c16573d45263bd9/684795ac/video/tos/useast8/tos-useast8-ve-0068c003-tx2/oQDfGF98ANhRSDsVE8cEmfM8GpEEqm4VAQBoIQ/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1128&bt=564&cs=0&ds=6&ft=GSDrKInz7ThVVrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=Zzo5O2gzPDhpZDVlM2VoZUBpM29sbnA5cnM5dDMzaTczNEA2L2AuMzVgXi8xMWEvNmBgYSNyLzRjMmRrcmhgLS1kMTJzcw%3D%3D&vvpl=1&l=2025060920162924E438DB72DE5707876A&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/d8b1856c655de0f502947373bd881aca/68479563/video/tos/useast8/tos-useast8-ve-0068c003-tx2/o8hBiA2UwC5kWnMOIQE9ivueqBZAzEAhsiIIAK/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1884&bt=942&cs=0&ds=6&ft=GSDrKInz7ThqKrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=M2VoaDw5Zmk3NDxlZjozZUBpM3ByO3M5cngzdTMzaTczNEAuXzU0LS1fNmAxLy82YF81YSNrZGJeMmRrYDRgLS1kMTJzcw%3D%3D&vvpl=1&l=20250609201523496764786A1B990741D3&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/d350db67562a35afcad6969dfc098415/684791e3/video/tos/useast5/tos-useast5-ve-0068c002-tx/okkJ6gjjgQ7fISjHINIApzGhLZegACFJvIb0eM/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1762&bt=881&cs=0&ds=6&ft=GSDrKInz7Th_J~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=Mzk4O2Y6Mzw5Zjo1ZWc0aUBpM2p4aHI5cnU3dTMzZzczNEAzLTAyLWIvNi8xYDBjLmNiYSM1NjRjMmQ0YG5gLS1kMS9zcw%3D%3D&vvpl=1&l=202506092000207CCF023BF81E3E1C6E50&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/45a4673a676fc18ce990c9f7b50c5430/6847905e/video/tos/useast5/tos-useast5-pve-0068-tx/oYJNSAM4gHCQe1s98IAARvYXshKT28e7GfXjkI/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=3396&bt=1698&cs=0&ds=6&ft=GSDrKInz7ThKz~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=NzozMzVpOWdmNWhlZTM2aEBpajpwaHc5cnRqdDMzZzczNEA0M2A1MDEtXy0xYV8xMl5gYSNrYjZlMmRjcmZgLS1kMS9zcw%3D%3D&vvpl=1&l=20250609195324E4DA53ACBB307E1E59DA&btag=e00090000",
    "https://v16m.tiktokcdn-us.com/d617301670382c0732202fbc472b23bd/68479555/video/tos/useast8/tos-useast8-ve-0068c004-tx2/ogEDmzQ7WdLLEBfW75sEyd4AETVMMDDINAfFRv/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2540&bt=1270&cs=0&ds=6&ft=GSDrKInz7ThqKrzKXq8Zmo&mime_type=video_mp4&qs=0&rc=O2llNThpMzxmNzxkNDw5ZUBpajR0a3c5cjVldTMzaTczNEBiMDReNWNgXi4xMS4xMS8zYSNzcWlpMmRzajNgLS1kMTJzcw%3D%3D&vvpl=1&l=20250609201523496764786A1B990741D3&btag=e000b8000",
    "https://v16m.tiktokcdn-us.com/e92231fef3732d37f3c511b171cb66d0/68479455/video/tos/useast5/tos-useast5-pve-0068-tx/owE4bmZOzJWRTiiPUrSQs4hBCgnBEpIEFEBAl/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2078&bt=1039&cs=0&ds=6&ft=GSDrKInz7Thsw~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=ZTQ3OmdkOzQ2PDo3ZjQ4OEBpM3B4O3I5cjRwdTMzZzczNEAtYmEwXmAzXmIxMTEvXjNjYSMuYGA0MmQ0ajFgLS1kMS9zcw%3D%3D&vvpl=1&l=202506092010471CE125FCC91ECE19E85F&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/8c7af8289d7391cbe828db535953a752/684795d4/video/tos/useast8/tos-useast8-ve-0068c002-tx2/oYBEAuIIVXJsEioteFr1EoECiDxHf4APRQBAsV/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1716&bt=858&cs=0&ds=6&ft=GSDrKInz7ThR9rzKXq8Zmo&mime_type=video_mp4&qs=0&rc=Mzc4OTxnODQ1aTU1ZDg3NUBpaml2aXI5cmdlMzMzaTczNEA1MmA0Y2EzXmMxYTM2YDNiYSNqL2ZpMmRjLWVhLS1kMTJzcw%3D%3D&vvpl=1&l=20250609201736EFCB842DE585351D1C12&btag=e000b8000",
    "https://v16m.tiktokcdn-us.com/71a3a11082a5952921d5bdb0bfdda5fc/684795df/video/tos/useast8/tos-useast8-ve-0068c004-tx2/ocIISFQhWCEjIfDcEfJSrqQAEJtWMJtHVIeAj8/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2442&bt=1221&cs=0&ds=6&ft=GSDrKInz7ThR9rzKXq8Zmo&mime_type=video_mp4&qs=0&rc=ZTczODU4PDU6aWY3OTkzZ0BpMzZ3ZHA5cjRlMzMzaTczNEBjYl42MGAvXjUxMTY0Li8xYSMzX29sMmRzYzZhLS1kMTJzcw%3D%3D&vvpl=1&l=20250609201736EFCB842DE585351D1C12&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/954ea8b74b39edaf51e1ff88de590f31/684794b8/video/tos/useast5/tos-useast5-ve-0068c003-tx/o0rAmp9wEWEU4y9vd5i4Q9ISQE1GiBZgRu2TB/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2602&bt=1301&cs=0&ds=6&ft=GSDrKInz7ThIw~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=ODVmaDg0OmY2Zzk0aWhlOkBpanJwZWw5cmpueDMzZzczNEBjM2JfLS4vXzQxLzIwMDIvYSNoYWsvMmRrYGJgLS1kMS9zcw%3D%3D&vvpl=1&l=2025060920111178F0F383A20B091C5D77&btag=e00090000",
    "https://v16m.tiktokcdn-us.com/7e62734068f0c8a51dc2a15927a4e6c4/6847917d/video/tos/useast5/tos-useast5-ve-0068c004-tx/oUfRIEqEEecEKGAAC3BOEl1CgQFxDnAAg5DSnE/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2188&bt=1094&cs=0&ds=6&ft=GSDrKInz7ThzC~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=ZWUzPDs3Z2VlOmZlaDU6N0BpMzVxM3g5cjozeDMzZzczNEAxLi0yL15fXmIxM18xLjIuYSMvZjMvMmQ0aS1gLS1kMS9zcw%3D%3D&vvpl=1&l=20250609195835878E3716A1F8342D6728&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/37bb3bcf986bb9297f91729a577b6e69/68478e6e/video/tos/useast8/tos-useast8-pve-0068-tx2/osScFeARIPiLqJkAEAkgfwgfGHCrGQAaReKRsU/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1768&bt=884&cs=0&ds=6&ft=GSDrKInz7Thy.~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=NTU2aGdlaDxlNWk4OTQzN0BpM2VlM3A5cnM8djMzaTczNEBhL2M2YDBjNjUxLWBhYzYwYSMzaTJoMmRzLnNgLS1kMTJzcw%3D%3D&vvpl=1&l=202506091945414E597F617517E4216448&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/85e3f9a26ebf0ce91b41bca875b26e7a/68478f74/video/tos/useast8/tos-useast8-pve-0068-tx2/oI9wHgRiQ4IwAsWMCfLIArGxIDAj8e1IQ8edqL/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2628&bt=1314&cs=0&ds=6&ft=GSDrKInz7Th7N~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=ZGczZjRoNDg5NTpmNDg4ZUBpanBmOnk5cng4MzMzaTczNEBfXjIuNTFjNV4xMDBhLWA2YSM1cWlzMmQ0bjBhLS1kMTJzcw%3D%3D&vvpl=1&l=20250609194949BA701507C8763E1878FA&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/2d4a714560a3e82db023935ef0ae59ed/68478f5d/video/tos/useast5/tos-useast5-pve-0068-tx/osFtRxxqsUvEN2Gi3DRpwy46BQEZgi3orBcAI/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2870&bt=1435&cs=0&ds=6&ft=GSDrKInz7Th7N~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=ZTZlZDc1OTk8Nzs7PDZmO0Bpamx4M2s5cmd4dzMzZzczNEBjMjMyX2IuNWExXzU2MDEvYSNoaXJsMmRrZGpgLS1kMS9zcw%3D%3D&vvpl=1&l=20250609194949BA701507C8763E1878FA&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/1ac65cc469eb13324a3cf4f47e830e92/684795eb/video/tos/useast5/tos-useast5-ve-0068c002-tx/oEubIHRB4PQdUiBglEE80BsAaHEG3WQXNiUL3/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2894&bt=1447&cs=0&ds=6&ft=GSDrKInz7ThR9rzKXq8Zmo&mime_type=video_mp4&qs=0&rc=OmdlOjkzPDM5OjtlZGg6aEBpMzo3b3E5cnVrMzMzZzczNEBjMV9iYzMyX2AxYl8yMS40YSNqai9vMmQ0LWJhLS1kMS9zcw%3D%3D&vvpl=1&l=20250609201736EFCB842DE585351D1C12&btag=e00088000",
    "https://v16m.tiktokcdn-us.com/f7349eab9e05bd5c09724e3b1fe78eee/684795dc/video/tos/useast5/tos-useast5-ve-0068c001-tx/o4DBsB0hyUvErATiHuZSkH4zBQEagi2LgBlAI/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=1730&bt=865&cs=0&ds=6&ft=GSDrKInz7ThR9rzKXq8Zmo&mime_type=video_mp4&qs=0&rc=aWc0ODc6Mzk1ZTw8ODlpaUBpMzp0ZW45cmV2MzMzZzczNEBeMzM2NC8tNjQxYmAtYC40YSM2L2pmMmRray1hLS1kMS9zcw%3D%3D&vvpl=1&l=20250609201736EFCB842DE585351D1C12&btag=e000b8000",
    "https://v16m.tiktokcdn-us.com/de79e9e8218b6ef479056f1785952424/68478b95/video/tos/useast5/tos-useast5-ve-0068c002-tx/ocAHQPFs8WMEeCwEeFGMUI5ak2ZjImLAixeIvx/?a=1180&bti=cWxkbHZsfGhkdzF3anZsZnJmbHFvbWtcZHFvcHBlZmsrYjo%3D&ch=0&cr=0&dr=0&er=0&lr=default&cd=0%7C0%7C0%7C0&cv=1&br=2490&bt=1245&cs=0&ds=6&ft=GSDrKInz7ThM8~zKXq8Zmo&mime_type=video_mp4&qs=0&rc=Ozk7aTRnNzlnNDpmNDY5OUBpajhzcHk5cnE5czMzZzczNEAuLTRjYjEzNWAxLmJgXzJhYSNrNTQyMmQ0NmpgLS1kMS9zcw%3D%3D&vvpl=1&l=20250609193344E36748642E9D5A17C689&btag=e00088000"
];

        // Variables
        let currentIndex = 0;
        let results = [];
        let isRunning = false;

        // Initialize
        function init() {
          // Display resources in the list
          resourcesList.innerHTML = "";
          resources.forEach((resource, index) => {
            const li = document.createElement("li");
            li.textContent = `Resource ${index + 1}: ${resource.substring(
              0,
              50
            )}...`;
            resourcesList.appendChild(li);
          });

          // Set total resources count
          totalResourcesEl.textContent = resources.length;
        }

        // Format bytes to readable format
        function formatBytes(bytes, decimals = 2) {
          if (bytes === 0) return "0 Bytes";
          const k = 1024;
          const dm = decimals < 0 ? 0 : decimals;
          const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + " " + sizes[i]
          );
        }

        // Format speed
        function formatSpeed(bytes, milliseconds) {
          const seconds = milliseconds / 1000;
          const bytesPerSecond = bytes / seconds;
          return formatBytes(bytesPerSecond) + "/s";
        }

        // Get client IP address
        async function getClientIP() {
          try {
            const response = await fetch("https://api.ipify.org?format=json");
            const data = await response.json();
            return data.ip;
          } catch (error) {
            console.error("Error fetching client IP:", error);
            return "Unknown";
          }
        }

        // Get target IP address from hostname
        async function getTargetIP(url) {
          try {
            const hostname = new URL(url).hostname;
            // Note: This is a mock implementation since DNS lookups aren't directly possible in browser JavaScript
            // In a real implementation, you would need a server-side component or use a service
            return `${hostname} (IP lookup requires server-side code)`;
          } catch (error) {
            console.error("Error getting target IP:", error);
            return "Unknown";
          }
        }

        // Test resource
        async function testResource(url, index) {
          const row = document.createElement("tr");
          row.classList.add("testing");
          row.innerHTML = `
                  <td>${index + 1}</td>
                  <td>${url.substring(0, 50)}...</td>
                  <td>Testing...</td>
                  <td>Testing...</td>
                  <td>Testing...</td>
                  <td><span class="debug-toggle" data-index="${index}">Show Debug Info</span><div class="debug-info hidden" id="debug-${index}">Loading...</div></td>
                `;
          resultsBody.appendChild(row);

          try {
            const startTime = performance.now();
            const requestTime = new Date().toISOString();
            const clientIP = await getClientIP();
            const targetIP = await getTargetIP(url);

            // Fetch the resource
            const response = await fetch(url, {
              method: "GET",
              headers: {
                Range: "bytes=0-999999",
              },
              mode: "cors",
              cache: "no-cache",
            });

            // Get response headers
            const headers = {};
            response.headers.forEach((value, key) => {
              headers[key] = value;
            });

            const endTime = performance.now();
            const waitingTime = endTime - startTime;

            // Get content length from headers
            const contentLength = parseInt(headers["content-length"] || 0);
            const downloadSpeed =
              contentLength > 0
                ? formatSpeed(contentLength, waitingTime)
                : "N/A";

            // Create debug info
            const debugInfo = {
              resourceURL: url,
              clientIP,
              targetIP,
              requestTime,
              responseHeaders: headers,
              responseTime: new Date().toISOString(),
              responseStatus: response.status,
              responseStatusText: response.statusText,
            };

            // Update the debug info div
            const debugDiv = document.getElementById(`debug-${index}`);
            debugDiv.innerHTML = `
                    <h4>Resource URL:</h4>
                    <pre>${debugInfo.resourceURL}</pre>
                    <h4>Client IP:</h4>
                    <pre>${debugInfo.clientIP}</pre>
                    <h4>Target IP:</h4>
                    <pre>${debugInfo.targetIP}</pre>
                    <h4>Request Time:</h4>
                    <pre>${debugInfo.requestTime}</pre>
                    <h4>Response Time:</h4>
                    <pre>${debugInfo.responseTime}</pre>
                    <h4>Response Headers:</h4>
                    <pre>${JSON.stringify(
                      debugInfo.responseHeaders,
                      null,
                      2
                    )}</pre>
                  `;

            // Update the row with results
            row.classList.remove("testing");
            row.classList.add("completed");
            row.cells[2].textContent = waitingTime.toFixed(2);
            row.cells[3].textContent = downloadSpeed;
            row.cells[4].textContent = `${response.status} ${response.statusText}`;

            // Add to results
            results.push({
              url,
              waitingTime,
              downloadSpeed,
              status: response.status,
              debugInfo,
            });

            return true;
          } catch (error) {
            console.error(`Error testing resource ${index + 1}:`, error);

            // Update the debug info div with error
            const debugDiv = document.getElementById(`debug-${index}`);
            debugDiv.innerHTML = `
                    <h4>Error:</h4>
                    <pre>${error.message}</pre>
                  `;

            row.classList.remove("testing");
            row.classList.add("error");
            row.cells[2].textContent = "Error";
            row.cells[3].textContent = "Error";
            row.cells[4].textContent = error.message;

            // Add to results
            results.push({
              url,
              waitingTime: 0,
              downloadSpeed: "Error",
              status: "Error",
              error: error.message,
            });

            return false;
          }
        }

        // Run tests
        async function runTests() {
          isRunning = true;
          startBtn.disabled = true;
          resetBtn.disabled = true;
          calculateBtn.disabled = true;
          results = [];
          resultsBody.innerHTML = "";
          summaryCard.style.display = "none";

          let successCount = 0;

          for (let i = 0; i < resources.length; i++) {
            currentIndex = i;
            const success = await testResource(resources[i], i);
            if (success) successCount++;

            // Update progress
            const progress = ((i + 1) / resources.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}%`;
          }

          // Enable buttons
          isRunning = false;
          startBtn.disabled = false;
          resetBtn.disabled = false;
          calculateBtn.disabled = false;

          // Update successful tests count
          successfulTestsEl.textContent = successCount;

          // Add event listeners for debug toggles
          document.querySelectorAll(".debug-toggle").forEach((toggle) => {
            toggle.addEventListener("click", function () {
              const index = this.getAttribute("data-index");
              const debugInfo = document.getElementById(`debug-${index}`);
              if (debugInfo.classList.contains("hidden")) {
                debugInfo.classList.remove("hidden");
                this.textContent = "Hide Debug Info";
              } else {
                debugInfo.classList.add("hidden");
                this.textContent = "Show Debug Info";
              }
            });
          });
        }

        // Calculate statistics
        function calculateStats() {
          if (results.length === 0) return;

          // Filter out errors
          const successfulResults = results.filter(
            (result) => result.status !== "Error"
          );

          if (successfulResults.length === 0) {
            avgWaitingTimeEl.textContent = "N/A";
            avgDownloadSpeedEl.textContent = "N/A";
            return;
          }

          // Calculate average waiting time
          const totalWaitingTime = successfulResults.reduce(
            (sum, result) => sum + result.waitingTime,
            0
          );
          const avgWaitingTime = totalWaitingTime / successfulResults.length;
          avgWaitingTimeEl.textContent = avgWaitingTime.toFixed(2) + " ms";

          // For download speed, we can only show a qualitative assessment
          avgDownloadSpeedEl.textContent = "See individual results";

          // Show summary card
          summaryCard.style.display = "block";
        }

        // Reset
        function reset() {
          if (isRunning) return;

          results = [];
          resultsBody.innerHTML = "";
          progressBar.style.width = "0%";
          progressText.textContent = "0%";
          summaryCard.style.display = "none";
          avgWaitingTimeEl.textContent = "-";
          avgDownloadSpeedEl.textContent = "-";
          successfulTestsEl.textContent = "-";
        }

        // Event listeners
        startBtn.addEventListener("click", runTests);
        resetBtn.addEventListener("click", reset);
        calculateBtn.addEventListener("click", calculateStats);

        // Initialize
        init();
      });
    </script>
  </body>
</html>
